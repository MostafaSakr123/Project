@page
@model Project.Pages.Student_RegistrationModel
@{
    ViewData["Title"] = "Course Registration";
}

<h2>Course Registration</h2>

@if (!string.IsNullOrEmpty(Model.Message))
{
    <div style="background:#e0ffe0; padding:10px; margin-bottom:15px;">
        @Model.Message
    </div>
}

<div style="display:flex; gap:30px;">
    <!-- SEARCH PANEL -->
    <div style="flex:2; border:1px solid #ccc; padding:15px; border-radius:4px;">
        <form method="get">
            <input asp-for="CourseName"
                   placeholder="Course name or code"
                   style="width:70%;"
                   value="@Model.CourseName" />
            <button type="submit">Search</button>
        </form>

        @if (Model.HasSearched)
        {
            @if (!string.IsNullOrEmpty(Model.Message))
            {
                <!-- message shown above -->
            }
            else if (Model.AvailableSections.Any())
            {
                <table style="width:100%; margin-top:15px; border-collapse:collapse;">
                    <thead style="background:#f0f0f0;">
                        <tr>
                            <th style="border:1px solid #ddd; padding:8px;">Code</th>
                            <th style="border:1px solid #ddd; padding:8px;">Section</th>
                            <th style="border:1px solid #ddd; padding:8px;">Day</th>
                            <th style="border:1px solid #ddd; padding:8px;">Time</th>
                            <th style="border:1px solid #ddd; padding:8px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var s in Model.AvailableSections)
                        {
                            <tr>
                                <td style="border:1px solid #ddd; padding:8px;">@s.CourseCode</td>
                                <td style="border:1px solid #ddd; padding:8px;">@s.SectionNumber</td>
                                <td style="border:1px solid #ddd; padding:8px;">@s.Day</td>
                                <td style="border:1px solid #ddd; padding:8px;">@s.StartTime–@s.EndTime</td>
                                <td style="border:1px solid #ddd; padding:8px; text-align:center;">
                                    <form method="post" asp-page-handler="AddToCart">
                                        <input type="hidden" asp-for="CourseName" />
                                        <input type="hidden" name="courseCode" value="@s.CourseCode" />
                                        <input type="hidden" name="sectionNumber" value="@s.SectionNumber" />
                                        <button type="submit">Select</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p style="margin-top:15px;">No sections found for "@Model.CourseName".</p>
            }
        }
    </div>

    <!-- SELECTION & REGISTER PANEL -->
    <div style="flex:1; border:1px solid #ccc; padding:15px; border-radius:4px;">
        <h4>Your Selection</h4>
        @if (Model.Selected == null)
        {
            <p>(none)</p>
        }
        else
        {
            <p>
                <strong>@Model.Selected.CourseCode</strong>
                Section <strong>@Model.Selected.SectionNumber</strong><br />
                (@Model.Selected.Day, @Model.Selected.StartTime–@Model.Selected.EndTime)
            </p>
            <form method="post" asp-page-handler="RemoveFromCart" style="display:inline;">
                <input type="hidden" asp-for="CourseName" />
                <button type="submit">Remove</button>
            </form>
            <form method="post" asp-page-handler="Register" style="display:inline; margin-left:10px;">
                <input type="hidden" asp-for="CourseName" />
                <button type="submit">Register</button>
            </form>
        }
    </div>
</div>
