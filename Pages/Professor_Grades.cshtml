@page
@using System.Data
@model Project.Pages.Professor_GradesModel
@{
    ViewData["Title"] = "Grade Management";
}

<div class="card shadow">
    <div class="card-header bg-primary text-white">
        <h3>Submit Grades</h3>
    </div>
    <div class="card-body">
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show mb-4">
                @TempData["SuccessMessage"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        <form method="post" class="needs-validation" novalidate>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Course</label>
                    <select class="form-select" asp-for="SelectedCourse" required>
                        <option value="">-- Select Course --</option>
                        @foreach (DataRow row in Model.ProfessorCourses.Rows)
                        {
                            <option value="@row["Course_Code"]"
                                    selected="@(row["Course_Code"].ToString() == Model.SelectedCourse)">
                                @row["Course_Code"]
                            </option>
                        }
                    </select>
                    <span asp-validation-for="SelectedCourse" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Student ID</label>
                    <input type="text" class="form-control" asp-for="StudentId"
                           pattern="[0-9]{9}" title="Must be exactly 9 digits" required>
                    <span asp-validation-for="StudentId" class="text-danger"></span>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-4">
                    <label class="form-label">Semester</label>
                    <select class="form-select" asp-for="semester" required>
                        <option value="">-- Select Semester --</option>
                        <option>Fall 2024</option>
                        <option>Spring 2024</option>
                        <option>Fall 2023</option>
                        <option>Summer 2023</option>
                    </select>
                    <span asp-validation-for="semester" class="text-danger"></span>
                </div>
            </div>
           
            <div class="mb-4">
                <label class="form-label">Grade Components</label>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>Component</th>
                                <th>Score (0-100)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Course Work (60%)</td>
                                <td>
                                    <input type="number" class="form-control"
                                           asp-for="AssignmentScore" min="0" max="100" required>
                                    <span asp-validation-for="AssignmentScore" class="text-danger"></span>
                                </td>
                            </tr>
                            <tr>
                                <td>Exams (40%)</td>
                                <td>
                                    <input type="number" class="form-control"
                                           asp-for="ExamScore" min="0" max="100" required>
                                    <span asp-validation-for="ExamScore" class="text-danger"></span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Insert after the grade components table -->
            <div class="mt-4 d-flex gap-2">
                <a asp-page="/ViewGrades" class="btn btn-primary">
                    <i class="bi bi-list-check me-2"></i>View Grades
                </a>
            </div>

            @if (!string.IsNullOrEmpty(Model.CalculatedGrade))
            {
                <div class="alert alert-info mb-4">
                    <strong>Calculated Grade:</strong> @Model.CalculatedGrade
                </div>
            }
\            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show mb-4">
                    @TempData["ErrorMessage"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

        

            <div class="d-flex justify-content-between">
                <button type="submit" class="btn btn-secondary" asp-page-handler="Calculate">
                    Calculate Grade
                </button>
                <button type="submit" class="btn btn-primary" asp-page-handler="Submit">
                    Submit Grade
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}